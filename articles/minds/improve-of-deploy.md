# 前端部署的演进

## 基础部署

前端网页能被访问的前提，一个是网址对应的资源，一个是网络发现。<br />
所以通常来讲，把 `.html` 等资源放到服务器上，然后使用 `nginx` 等工具做网络代理，即可将网址指向前端内容。

比如**上传资源**部分：

* 在本地 `npm run build`，得到了 `dist/*` 等资源文件。
* 若你买了个 `windows` 轻量服务器。
* 把资源文件 `Ctrl+C` 拷贝到服务器的 `D://web/*` 文件夹中。
* 而若你买的其他服务器，没有可视化界面了。
* 则需要一些 `ssh` 命令，比如 `scp -r local_path username@ip:path` 等。
* 或者 `WinSCP` 之类的可视化工具来进行上传。

而**网络发现**部分：

* 此时访问 `[ip]/index.html` 是访问不到的资源。
* 你可以进行 `nginx.conf` 配置比如 `location / { root D://web; }` 后，即可访问网址则能看到内容了。
* 也有其他方式，比如 `windows` 的 `IIS` 配置或 `route add` 命令等。

当然，你也可以不用自己的服务器，而是第三方的服务器：

* 比如 `COS` 文件服务器，用管理后台或相应 `SDK` 去上传即可。
* 比如托管服务，像 `github pages`、`vercel`、`netlify` 等也相当方便。

至于不想只是 `IP` 地址来访问，而是域名，则需要域名 `DNS` 解析即可，就是另个小课题了。

## 自动化上传

显然，多半情况下，网络发现配置仅配置一次即可，更需要频繁更新的是上传资源，那么自动化上传提上日程。

那么就需要两个考虑，一个是自动化程序，一个是上传时机。

**上传时机**方面：

上传时机主要靠的是 `git hooks`，比如 `post-merge` 之类的。<br />
*当然你说本地运行些 `npm run deploy` 的命令也行，但多半其实监听的也是 `pre-push` 之类的时机，或者比较手动的。*

* 而像 `github`、工蜂 之类的代码托管的平台上，也多半有进行配置 `git hooks` 的地方，甚至有 `tag push` 等时机的拓展。
* 如果你是自建部署平台，比如 `Jenkins`、`Bamboo` 等各式持续集成工具，同样可以配置。
* 至于托管服务，比如 `vercel`、`netlify` 等，其实只是隐藏了上述内容，只需要更少的配置而已。

**自动化程序**方面：

程序就比较简单了，通常就是 `NodeJs` 脚本即可，只看你想在什么环境下去走这些流程，可见下一章。

另外，除了 `build` 和 `upload` 之外，这个阶段你还可以干很多事，比如加版本、统计体积、自动化测试等。

## 自动化环境

如果是团队合作，一个用 `mac` 一个用 `win`，一个用 `nodejs18` 一个用 `nodejs16`，或者两人的 `npm global` 依赖版本不一致，<br />
那么上述过程在本地运行，就会造成结果可能不一致，不同人部署的结果就不同。

所以，需要一个自动化环境，来保证打包结果的统一。<br />
在上传时机板块就已经涉及到了，无论是第三方平台还是自建服务，都是比较独立的环境了。

最简单的方式就是利用托管平台，只是看它是否提供了自定义脚本的方式。<br />
如果能自己写脚本那触发 `npm run deploy` 之类的命令即可，如果不能就只能另搭服务提供给它 `Webhooks` 了。

而自建部署平台，无论你用的简单 `jenkins` 还是什么能私有化的流水线平台，就得买个服务器了。

## 分布式部署

扯到分布式就要先了解 `docker` 和 `k8s`，就要了解下容器化技术。

* 其中 `docker` 可以保证不管你的服务器无论是 `win` 还是 `linux`，始终是一样的 `docker` 中包含的环境。
* 而 `k8s` 可以保证当你新加服务器时能自动部署，减少服务器时不会让网络发现打空。

